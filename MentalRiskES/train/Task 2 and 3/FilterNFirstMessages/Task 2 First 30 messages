{"nbformat":4,"nbformat_minor":0,"metadata":{"colab":{"provenance":[],"authorship_tag":"ABX9TyNG9wA7KoOluru3jh6pIdxN"},"kernelspec":{"name":"python3","display_name":"Python 3"},"language_info":{"name":"python"},"accelerator":"GPU","gpuClass":"standard","widgets":{"application/vnd.jupyter.widget-state+json":{"d4dc443866734e5e806e8a125a11f91b":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_e28f536fed994b08a558584cb60b7efd","IPY_MODEL_f7258bfdf0ab4f2586b917cae2dc6c67","IPY_MODEL_ea3e0356e6f64d468970b05635200095"],"layout":"IPY_MODEL_04e244b7ae6e454d93f3baf9242699c5"}},"e28f536fed994b08a558584cb60b7efd":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_78dd0fd9e4a34856ae71dbbbd61b96d7","placeholder":"​","style":"IPY_MODEL_1d58ae79ca6e4645b26c60a9cf6335aa","value":"100%"}},"f7258bfdf0ab4f2586b917cae2dc6c67":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_06df49c4f09642d1b1e453865f1df08b","max":1,"min":0,"orientation":"horizontal","style":"IPY_MODEL_4303e46733a748d9a60dd7046f2a30fd","value":1}},"ea3e0356e6f64d468970b05635200095":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_719fe2c3fa954fe1b9fd30490ede06db","placeholder":"​","style":"IPY_MODEL_1c14afc14d8743d98feadf10823c158f","value":" 1/1 [00:00&lt;00:00, 53.31it/s]"}},"04e244b7ae6e454d93f3baf9242699c5":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"78dd0fd9e4a34856ae71dbbbd61b96d7":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"1d58ae79ca6e4645b26c60a9cf6335aa":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"06df49c4f09642d1b1e453865f1df08b":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"4303e46733a748d9a60dd7046f2a30fd":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"719fe2c3fa954fe1b9fd30490ede06db":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"1c14afc14d8743d98feadf10823c158f":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"6c443d07cae04723bc7148569ecee05e":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_2183197244ff4f92b7b69c0126b67e09","IPY_MODEL_ca3ddd15e00e415486fab2a3d6eb2f42","IPY_MODEL_3716930ba95a40179d79d42b1e4130b5"],"layout":"IPY_MODEL_ca2bd148f4874e3db6b69161dafd1acb"}},"2183197244ff4f92b7b69c0126b67e09":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_980364fe49f146528f65957b93324d80","placeholder":"​","style":"IPY_MODEL_6ef39cd43cf744f3861688cdc56180bb","value":"Downloading (…)lve/main/config.json: 100%"}},"ca3ddd15e00e415486fab2a3d6eb2f42":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_f38a12586d7b4e64b8aa550087db7c34","max":430,"min":0,"orientation":"horizontal","style":"IPY_MODEL_8a0aff0d570c442195ea9c34a20e4c56","value":430}},"3716930ba95a40179d79d42b1e4130b5":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_73651aa236bd45d2b40803fb47257056","placeholder":"​","style":"IPY_MODEL_c0e63c452ea3452e832cc5cf888bcfbb","value":" 430/430 [00:00&lt;00:00, 7.58kB/s]"}},"ca2bd148f4874e3db6b69161dafd1acb":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"980364fe49f146528f65957b93324d80":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"6ef39cd43cf744f3861688cdc56180bb":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"f38a12586d7b4e64b8aa550087db7c34":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"8a0aff0d570c442195ea9c34a20e4c56":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"73651aa236bd45d2b40803fb47257056":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"c0e63c452ea3452e832cc5cf888bcfbb":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"693cde4dd1d1405495abaf17230e69f4":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_809f0f0584be44d0b430cd8b30e29c3c","IPY_MODEL_9c469ac9ca524caf925d3229c2c51bee","IPY_MODEL_d26b85dd9b654de2a9af7b5e821a26d5"],"layout":"IPY_MODEL_771de3eb515a42f8b243fc72189763e0"}},"809f0f0584be44d0b430cd8b30e29c3c":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_b992aead101746df98face227c79afa3","placeholder":"​","style":"IPY_MODEL_ef193142f926441daf682945d36a2ba1","value":"Downloading pytorch_model.bin: 100%"}},"9c469ac9ca524caf925d3229c2c51bee":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_288102bf114d4207a1651dfe05c932a9","max":470657952,"min":0,"orientation":"horizontal","style":"IPY_MODEL_74d393028a3842859019cbce93b21dd0","value":470657952}},"d26b85dd9b654de2a9af7b5e821a26d5":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_0dfe840073ce41648740c1a3dc86d768","placeholder":"​","style":"IPY_MODEL_365b106372494e179ea222d479191cac","value":" 471M/471M [00:06&lt;00:00, 89.5MB/s]"}},"771de3eb515a42f8b243fc72189763e0":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"b992aead101746df98face227c79afa3":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"ef193142f926441daf682945d36a2ba1":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"288102bf114d4207a1651dfe05c932a9":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"74d393028a3842859019cbce93b21dd0":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"0dfe840073ce41648740c1a3dc86d768":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"365b106372494e179ea222d479191cac":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}}}}},"cells":[{"cell_type":"code","execution_count":null,"metadata":{"id":"_BiM0RepL_H6","executionInfo":{"status":"ok","timestamp":1684924097053,"user_tz":-120,"elapsed":2340,"user":{"displayName":"CARLOS RODRIGUEZ CALZADA","userId":"12667430431079591890"}},"colab":{"base_uri":"https://localhost:8080/"},"outputId":"a723bd7f-9928-4589-b5ad-ba54a8d57c7e"},"outputs":[{"output_type":"stream","name":"stdout","text":["Drive already mounted at /content/drive; to attempt to forcibly remount, call drive.mount(\"/content/drive\", force_remount=True).\n"]}],"source":["from google.colab import drive\n","drive.mount('/content/drive')"]},{"cell_type":"code","source":["!pip install datasets transformers accelerate"],"metadata":{"id":"wCWqtrBkuBp9","executionInfo":{"status":"ok","timestamp":1684924103372,"user_tz":-120,"elapsed":6321,"user":{"displayName":"CARLOS RODRIGUEZ CALZADA","userId":"12667430431079591890"}},"colab":{"base_uri":"https://localhost:8080/"},"outputId":"8398f756-31c7-47ea-9ac2-87428483bad3"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/\n","Requirement already satisfied: datasets in /usr/local/lib/python3.10/dist-packages (2.12.0)\n","Requirement already satisfied: transformers in /usr/local/lib/python3.10/dist-packages (4.29.2)\n","Requirement already satisfied: accelerate in /usr/local/lib/python3.10/dist-packages (0.19.0)\n","Requirement already satisfied: numpy>=1.17 in /usr/local/lib/python3.10/dist-packages (from datasets) (1.22.4)\n","Requirement already satisfied: pyarrow>=8.0.0 in /usr/local/lib/python3.10/dist-packages (from datasets) (9.0.0)\n","Requirement already satisfied: dill<0.3.7,>=0.3.0 in /usr/local/lib/python3.10/dist-packages (from datasets) (0.3.6)\n","Requirement already satisfied: pandas in /usr/local/lib/python3.10/dist-packages (from datasets) (1.5.3)\n","Requirement already satisfied: requests>=2.19.0 in /usr/local/lib/python3.10/dist-packages (from datasets) (2.27.1)\n","Requirement already satisfied: tqdm>=4.62.1 in /usr/local/lib/python3.10/dist-packages (from datasets) (4.65.0)\n","Requirement already satisfied: xxhash in /usr/local/lib/python3.10/dist-packages (from datasets) (3.2.0)\n","Requirement already satisfied: multiprocess in /usr/local/lib/python3.10/dist-packages (from datasets) (0.70.14)\n","Requirement already satisfied: fsspec[http]>=2021.11.1 in /usr/local/lib/python3.10/dist-packages (from datasets) (2023.4.0)\n","Requirement already satisfied: aiohttp in /usr/local/lib/python3.10/dist-packages (from datasets) (3.8.4)\n","Requirement already satisfied: huggingface-hub<1.0.0,>=0.11.0 in /usr/local/lib/python3.10/dist-packages (from datasets) (0.14.1)\n","Requirement already satisfied: packaging in /usr/local/lib/python3.10/dist-packages (from datasets) (23.1)\n","Requirement already satisfied: responses<0.19 in /usr/local/lib/python3.10/dist-packages (from datasets) (0.18.0)\n","Requirement already satisfied: pyyaml>=5.1 in /usr/local/lib/python3.10/dist-packages (from datasets) (6.0)\n","Requirement already satisfied: filelock in /usr/local/lib/python3.10/dist-packages (from transformers) (3.12.0)\n","Requirement already satisfied: regex!=2019.12.17 in /usr/local/lib/python3.10/dist-packages (from transformers) (2022.10.31)\n","Requirement already satisfied: tokenizers!=0.11.3,<0.14,>=0.11.1 in /usr/local/lib/python3.10/dist-packages (from transformers) (0.13.3)\n","Requirement already satisfied: psutil in /usr/local/lib/python3.10/dist-packages (from accelerate) (5.9.5)\n","Requirement already satisfied: torch>=1.6.0 in /usr/local/lib/python3.10/dist-packages (from accelerate) (2.0.1+cu118)\n","Requirement already satisfied: attrs>=17.3.0 in /usr/local/lib/python3.10/dist-packages (from aiohttp->datasets) (23.1.0)\n","Requirement already satisfied: charset-normalizer<4.0,>=2.0 in /usr/local/lib/python3.10/dist-packages (from aiohttp->datasets) (2.0.12)\n","Requirement already satisfied: multidict<7.0,>=4.5 in /usr/local/lib/python3.10/dist-packages (from aiohttp->datasets) (6.0.4)\n","Requirement already satisfied: async-timeout<5.0,>=4.0.0a3 in /usr/local/lib/python3.10/dist-packages (from aiohttp->datasets) (4.0.2)\n","Requirement already satisfied: yarl<2.0,>=1.0 in /usr/local/lib/python3.10/dist-packages (from aiohttp->datasets) (1.9.2)\n","Requirement already satisfied: frozenlist>=1.1.1 in /usr/local/lib/python3.10/dist-packages (from aiohttp->datasets) (1.3.3)\n","Requirement already satisfied: aiosignal>=1.1.2 in /usr/local/lib/python3.10/dist-packages (from aiohttp->datasets) (1.3.1)\n","Requirement already satisfied: typing-extensions>=3.7.4.3 in /usr/local/lib/python3.10/dist-packages (from huggingface-hub<1.0.0,>=0.11.0->datasets) (4.5.0)\n","Requirement already satisfied: urllib3<1.27,>=1.21.1 in /usr/local/lib/python3.10/dist-packages (from requests>=2.19.0->datasets) (1.26.15)\n","Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.10/dist-packages (from requests>=2.19.0->datasets) (2022.12.7)\n","Requirement already satisfied: idna<4,>=2.5 in /usr/local/lib/python3.10/dist-packages (from requests>=2.19.0->datasets) (3.4)\n","Requirement already satisfied: sympy in /usr/local/lib/python3.10/dist-packages (from torch>=1.6.0->accelerate) (1.11.1)\n","Requirement already satisfied: networkx in /usr/local/lib/python3.10/dist-packages (from torch>=1.6.0->accelerate) (3.1)\n","Requirement already satisfied: jinja2 in /usr/local/lib/python3.10/dist-packages (from torch>=1.6.0->accelerate) (3.1.2)\n","Requirement already satisfied: triton==2.0.0 in /usr/local/lib/python3.10/dist-packages (from torch>=1.6.0->accelerate) (2.0.0)\n","Requirement already satisfied: cmake in /usr/local/lib/python3.10/dist-packages (from triton==2.0.0->torch>=1.6.0->accelerate) (3.25.2)\n","Requirement already satisfied: lit in /usr/local/lib/python3.10/dist-packages (from triton==2.0.0->torch>=1.6.0->accelerate) (16.0.5)\n","Requirement already satisfied: python-dateutil>=2.8.1 in /usr/local/lib/python3.10/dist-packages (from pandas->datasets) (2.8.2)\n","Requirement already satisfied: pytz>=2020.1 in /usr/local/lib/python3.10/dist-packages (from pandas->datasets) (2022.7.1)\n","Requirement already satisfied: six>=1.5 in /usr/local/lib/python3.10/dist-packages (from python-dateutil>=2.8.1->pandas->datasets) (1.16.0)\n","Requirement already satisfied: MarkupSafe>=2.0 in /usr/local/lib/python3.10/dist-packages (from jinja2->torch>=1.6.0->accelerate) (2.1.2)\n","Requirement already satisfied: mpmath>=0.19 in /usr/local/lib/python3.10/dist-packages (from sympy->torch>=1.6.0->accelerate) (1.3.0)\n"]}]},{"cell_type":"code","source":["gpu_info = !nvidia-smi\n","gpu_info = '\\n'.join(gpu_info)\n","if gpu_info.find('failed') >= 0:\n","  print('Not connected to a GPU')\n","else:\n","  print(gpu_info)"],"metadata":{"id":"13dCqvZhuxs_","executionInfo":{"status":"ok","timestamp":1684924103758,"user_tz":-120,"elapsed":392,"user":{"displayName":"CARLOS RODRIGUEZ CALZADA","userId":"12667430431079591890"}},"colab":{"base_uri":"https://localhost:8080/"},"outputId":"2b8de6f2-e5cd-4345-e53c-9c7f33a3b047"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["Wed May 24 10:28:23 2023       \n","+-----------------------------------------------------------------------------+\n","| NVIDIA-SMI 525.85.12    Driver Version: 525.85.12    CUDA Version: 12.0     |\n","|-------------------------------+----------------------+----------------------+\n","| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |\n","| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |\n","|                               |                      |               MIG M. |\n","|===============================+======================+======================|\n","|   0  Tesla T4            Off  | 00000000:00:04.0 Off |                    0 |\n","| N/A   70C    P0    31W /  70W |  11389MiB / 15360MiB |      0%      Default |\n","|                               |                      |                  N/A |\n","+-------------------------------+----------------------+----------------------+\n","                                                                               \n","+-----------------------------------------------------------------------------+\n","| Processes:                                                                  |\n","|  GPU   GI   CI        PID   Type   Process name                  GPU Memory |\n","|        ID   ID                                                   Usage      |\n","|=============================================================================|\n","+-----------------------------------------------------------------------------+\n"]}]},{"cell_type":"code","source":["import transformers, datasets\n","transformers.logging.set_verbosity_error()\n","datasets.logging.set_verbosity_error()"],"metadata":{"id":"4evkaVy1u46V"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["from datasets import load_dataset\n","\n","data_path = \"/content/drive/My Drive/TFG/MentalRiskES/train/Task 2/N messages/\"\n","dataset = load_dataset(\"csv\", data_files=data_path+\"output_30.csv\")\n","dataset"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":157,"referenced_widgets":["d4dc443866734e5e806e8a125a11f91b","e28f536fed994b08a558584cb60b7efd","f7258bfdf0ab4f2586b917cae2dc6c67","ea3e0356e6f64d468970b05635200095","04e244b7ae6e454d93f3baf9242699c5","78dd0fd9e4a34856ae71dbbbd61b96d7","1d58ae79ca6e4645b26c60a9cf6335aa","06df49c4f09642d1b1e453865f1df08b","4303e46733a748d9a60dd7046f2a30fd","719fe2c3fa954fe1b9fd30490ede06db","1c14afc14d8743d98feadf10823c158f"]},"id":"FMiyJWAHMa4-","executionInfo":{"status":"ok","timestamp":1684924103758,"user_tz":-120,"elapsed":10,"user":{"displayName":"CARLOS RODRIGUEZ CALZADA","userId":"12667430431079591890"}},"outputId":"88efa9e5-9f45-4fc5-fdf7-6a545706db0d"},"execution_count":null,"outputs":[{"output_type":"display_data","data":{"text/plain":["  0%|          | 0/1 [00:00<?, ?it/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"d4dc443866734e5e806e8a125a11f91b"}},"metadata":{}},{"output_type":"execute_result","data":{"text/plain":["DatasetDict({\n","    train: Dataset({\n","        features: ['Subject', 'Text', 'label'],\n","        num_rows: 175\n","    })\n","})"]},"metadata":{},"execution_count":81}]},{"cell_type":"code","source":["dataset = dataset[\"train\"].train_test_split(test_size=0.3, seed=42)\n","print(dataset)\n","\n","aux_dataset = dataset[\"test\"].train_test_split(test_size=0.33, seed=42)\n","print(aux_dataset)\n","\n","dataset['validation']=aux_dataset['test']\n","dataset['test']=aux_dataset['train']\n","del(aux_dataset)\n","print(dataset)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"0SxeW28IM7Va","executionInfo":{"status":"ok","timestamp":1684924103759,"user_tz":-120,"elapsed":9,"user":{"displayName":"CARLOS RODRIGUEZ CALZADA","userId":"12667430431079591890"}},"outputId":"78ab82f0-3c81-4976-dadb-aacb8a4674fd"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["DatasetDict({\n","    train: Dataset({\n","        features: ['Subject', 'Text', 'label'],\n","        num_rows: 122\n","    })\n","    test: Dataset({\n","        features: ['Subject', 'Text', 'label'],\n","        num_rows: 53\n","    })\n","})\n","DatasetDict({\n","    train: Dataset({\n","        features: ['Subject', 'Text', 'label'],\n","        num_rows: 35\n","    })\n","    test: Dataset({\n","        features: ['Subject', 'Text', 'label'],\n","        num_rows: 18\n","    })\n","})\n","DatasetDict({\n","    train: Dataset({\n","        features: ['Subject', 'Text', 'label'],\n","        num_rows: 122\n","    })\n","    test: Dataset({\n","        features: ['Subject', 'Text', 'label'],\n","        num_rows: 35\n","    })\n","    validation: Dataset({\n","        features: ['Subject', 'Text', 'label'],\n","        num_rows: 18\n","    })\n","})\n"]}]},{"cell_type":"code","source":["dataset['train'][0]"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"2Z_fyU-Eunev","executionInfo":{"status":"ok","timestamp":1684924103759,"user_tz":-120,"elapsed":8,"user":{"displayName":"CARLOS RODRIGUEZ CALZADA","userId":"12667430431079591890"}},"outputId":"638c417a-1bba-4a85-d362-1af18832ed82"},"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["{'Subject': 'subject117',\n"," 'Text': 'No creo que se refiera a ESA Biblia .... No pasa nada . Todos tienen derecho a tener amigos imaginarios .. ¿ A las cuantas visitas ? Creo que ya agote mi cupón .. Pues , ví personas hablándole a ventanas .. Catolicismo fue lo que consumieron .. Y el miedo lleva a la ira .. Detrás de la luna .. Shape es \" forma \" en inglés . Y yo soy un poco cambiaformas .. Que estoy cambiando todo el rato de identidad .. ¿ Ya me entendiste ?. No se lo toman en serio .. Es más bien ... una forma de hacer contracultura. Jona ... cí en esta ribera del Arauca vibrador .. notas musicales. A mí más bien con las puertas .. Tengo que repetir la operación varias veces , hasta que no suene como yo quiero .. Y también me pasa con las lámparas .. ¿ Sabes lo más cómico ?. Que estudio para profesional de la salud mental .. ¿ En qué año ?. Estoy en 4to de medicina .. Aquí en la Cuba hace un maldito calor. En La Habana estamos a 30 °. Yo te la presento . \" Hola , soy la Habana \". Ponla ya , si total , Putin no te va a ver jaja .. Yo he hablado con varios ucranianos .. Son muy simpáticos , y están locos .. Fue hace casi 10 años así que ya no recuerdo nada. Algún día quizá regreso .. Adelante , que ya es hora .',\n"," 'label': 0.0}"]},"metadata":{},"execution_count":83}]},{"cell_type":"code","source":["# MODEL_NAME='bert-base-multilingual-uncased'\n","\n","# XLM-T: This is a XLM-Roberta-base model trained on ~198M multilingual tweets\n","# MODEL_NAME= \"cardiffnlp/twitter-xlm-roberta-base\"\n","\n","# XLM-R: XLM-RoBERTa model pre-trained on 2.5TB of filtered CommonCrawl data containing 100 languages.\n","# MODEL_NAME= \"xlm-roberta-base\"\n","\n","# DistillBERT: a distilled version of the BERT base multilingual model. The model is trained on the concatenation of Wikipedia in 104 different languages\n","# The model has 6 layers, 768 dimension and 12 heads, totalizing 134M parameters (compared to 177M parameters for mBERT-base).\n","# On average, this model, referred to as DistilmBERT, is twice as fast as mBERT-base.\n","# MODEL_NAME= \"distilbert-base-multilingual-cased\"\n","\n","# MiniLM:Multilingual MiniLM uses the same tokenizer as XLM-R\n","MODEL_NAME= \"microsoft/Multilingual-MiniLM-L12-H384\"\n","\n","print('Using model:', MODEL_NAME)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"-MuWGUZOvBJu","executionInfo":{"status":"ok","timestamp":1684925059927,"user_tz":-120,"elapsed":229,"user":{"displayName":"CARLOS RODRIGUEZ CALZADA","userId":"12667430431079591890"}},"outputId":"01fc1b8e-e03e-4b81-c89c-0af54c76958c"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["Using model: microsoft/Multilingual-MiniLM-L12-H384\n"]}]},{"cell_type":"code","source":["from transformers import AutoTokenizer\n","\n","if 'MiniLM' in MODEL_NAME:\n","    # we must load the tokenizer of XLM-R\n","    tokenizer = AutoTokenizer.from_pretrained(\"xlm-roberta-base\")\n","else:\n","    tokenizer = AutoTokenizer.from_pretrained(MODEL_NAME)\n"],"metadata":{"id":"ljpBXXWTvF6b"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["len_train_texts = [len(tokenizer(text).input_ids) for text in dataset['train']['Text']]\n","\n","import pandas as pd\n","df=pd.Series(len_train_texts)\n","df.describe(percentiles=[0.25, 0.50, 0.75, 0.85, 0.90, 0.95, 0.99])"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"Fo_-iSvrvIfk","executionInfo":{"status":"ok","timestamp":1684925061830,"user_tz":-120,"elapsed":13,"user":{"displayName":"CARLOS RODRIGUEZ CALZADA","userId":"12667430431079591890"}},"outputId":"589a840e-7fb0-4f44-c021-3d12dcb4d9f8"},"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["count     122.000000\n","mean      472.081967\n","std       353.422922\n","min       105.000000\n","25%       282.500000\n","50%       388.500000\n","75%       547.000000\n","85%       671.400000\n","90%       795.700000\n","95%       989.450000\n","99%      2229.380000\n","max      2559.000000\n","dtype: float64"]},"metadata":{},"execution_count":122}]},{"cell_type":"markdown","source":["EJECUTAR HASTA AQUÍ PARA VER LA LEN"],"metadata":{"id":"lOL198jgvERj"}},{"cell_type":"code","source":["MAX_LEN = 512\n","\n","def tokenize(examples):\n","    ## it applies the tokenizer on the dataset in its field text\n","    # we could add max_length = MAX_LENGHT, but in this case is not neccesary because MAX_LENGTH is already 512, the maximum length allowed by the model\n","    return tokenizer(examples[\"Text\"], truncation=True, max_length=MAX_LEN, padding='max_length')\n","\n","\n","data_encodings=dataset.map(tokenize, batched=True)\n","data_encodings"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"MkV_0THcvUVE","executionInfo":{"status":"ok","timestamp":1684925061830,"user_tz":-120,"elapsed":10,"user":{"displayName":"CARLOS RODRIGUEZ CALZADA","userId":"12667430431079591890"}},"outputId":"4e3df8dd-ea5e-4721-8339-7828c0f12120"},"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["DatasetDict({\n","    train: Dataset({\n","        features: ['Subject', 'Text', 'label', 'input_ids', 'attention_mask'],\n","        num_rows: 122\n","    })\n","    test: Dataset({\n","        features: ['Subject', 'Text', 'label', 'input_ids', 'attention_mask'],\n","        num_rows: 35\n","    })\n","    validation: Dataset({\n","        features: ['Subject', 'Text', 'label', 'input_ids', 'attention_mask'],\n","        num_rows: 18\n","    })\n","})"]},"metadata":{},"execution_count":123}]},{"cell_type":"code","source":["data_encodings = data_encodings.remove_columns(['Text','Subject'])\n","data_encodings"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"_A3LcmxMwgo4","executionInfo":{"status":"ok","timestamp":1684925061830,"user_tz":-120,"elapsed":6,"user":{"displayName":"CARLOS RODRIGUEZ CALZADA","userId":"12667430431079591890"}},"outputId":"8ccf63de-3b47-459e-98fd-688d86a856e9"},"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["DatasetDict({\n","    train: Dataset({\n","        features: ['label', 'input_ids', 'attention_mask'],\n","        num_rows: 122\n","    })\n","    test: Dataset({\n","        features: ['label', 'input_ids', 'attention_mask'],\n","        num_rows: 35\n","    })\n","    validation: Dataset({\n","        features: ['label', 'input_ids', 'attention_mask'],\n","        num_rows: 18\n","    })\n","})"]},"metadata":{},"execution_count":124}]},{"cell_type":"code","source":["from transformers import AutoModelForSequenceClassification\n","# As num_labes is 1, the AutoModelForSequenceClassification will trigger the linear regression and use MSELoss() as the loss function automatically.\n","model = AutoModelForSequenceClassification.from_pretrained(MODEL_NAME, num_labels = 1).to(\"cuda\")"],"metadata":{"id":"o4YciE87wXsR","executionInfo":{"status":"ok","timestamp":1684925071875,"user_tz":-120,"elapsed":10048,"user":{"displayName":"CARLOS RODRIGUEZ CALZADA","userId":"12667430431079591890"}},"colab":{"base_uri":"https://localhost:8080/","height":81,"referenced_widgets":["6c443d07cae04723bc7148569ecee05e","2183197244ff4f92b7b69c0126b67e09","ca3ddd15e00e415486fab2a3d6eb2f42","3716930ba95a40179d79d42b1e4130b5","ca2bd148f4874e3db6b69161dafd1acb","980364fe49f146528f65957b93324d80","6ef39cd43cf744f3861688cdc56180bb","f38a12586d7b4e64b8aa550087db7c34","8a0aff0d570c442195ea9c34a20e4c56","73651aa236bd45d2b40803fb47257056","c0e63c452ea3452e832cc5cf888bcfbb","693cde4dd1d1405495abaf17230e69f4","809f0f0584be44d0b430cd8b30e29c3c","9c469ac9ca524caf925d3229c2c51bee","d26b85dd9b654de2a9af7b5e821a26d5","771de3eb515a42f8b243fc72189763e0","b992aead101746df98face227c79afa3","ef193142f926441daf682945d36a2ba1","288102bf114d4207a1651dfe05c932a9","74d393028a3842859019cbce93b21dd0","0dfe840073ce41648740c1a3dc86d768","365b106372494e179ea222d479191cac"]},"outputId":"522123f2-9c39-4f6c-f1fb-1f58970187a6"},"execution_count":null,"outputs":[{"output_type":"display_data","data":{"text/plain":["Downloading (…)lve/main/config.json:   0%|          | 0.00/430 [00:00<?, ?B/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"6c443d07cae04723bc7148569ecee05e"}},"metadata":{}},{"output_type":"display_data","data":{"text/plain":["Downloading pytorch_model.bin:   0%|          | 0.00/471M [00:00<?, ?B/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"693cde4dd1d1405495abaf17230e69f4"}},"metadata":{}}]},{"cell_type":"code","source":["import numpy as np\n","from sklearn.metrics import mean_squared_error, r2_score, mean_squared_error, mean_absolute_error\n","from scipy import stats\n","\n","def compute_metrics_for_regression(eval_pred):\n","    logits, labels = eval_pred\n","    labels = labels.reshape(-1, 1)\n","\n","    # loss metrics\n","    mse = mean_squared_error(labels, logits)\n","    rmse = mean_squared_error(labels, logits, squared=False)\n","    mae = mean_absolute_error(labels, logits)\n","    smape = 1/len(labels) * np.sum(2 * np.abs(logits-labels) / (np.abs(labels) + np.abs(logits))*100)\n","    # performance metrics\n","    r2 = r2_score(labels, logits)\n","    # pearson=stats.pearsonr(labels, logits)[0]\n","\n","    # we return a dictionary with all metrics\n","    # return {\"mse\": mse, \"rmse\": rmse, \"mae\": mae, \"r2\": r2, \"smape\": smape, \"pearson\": pearson}\n","    return {\"mse\": mse, \"rmse\": rmse, \"mae\": mae, \"r2\": r2, \"smape\": smape}"],"metadata":{"id":"Kn79dWOFwZxe"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["from transformers import TrainingArguments\n","\n","\n","NUM_EPOCHS = 15 # we recommend at least 3\n","\n","# Specifiy the arguments for the trainer\n","training_args = TrainingArguments(\n","    output_dir ='./results',\n","    num_train_epochs = NUM_EPOCHS,\n","    per_device_train_batch_size = 8, # 128 in the paper\n","    per_device_eval_batch_size = 8,\n","    weight_decay = 0.01,\n","    learning_rate = 2e-5,  # 0.001 in the paper,\n","    logging_dir = './logs',\n","    save_total_limit = 10,\n","    load_best_model_at_end = True,\n","    metric_for_best_model = 'rmse',\n","    evaluation_strategy = \"epoch\",  # steps in the paper\n","    save_strategy = \"epoch\",    # steps in the paper\n","    report_to = 'all',\n",")"],"metadata":{"id":"pL_uOTjYwcSY"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["from transformers import Trainer, EarlyStoppingCallback\n","\n","# Call the Trainer\n","trainer = Trainer(\n","    model = model,\n","    args = training_args,\n","    train_dataset = data_encodings['train'],\n","    eval_dataset = data_encodings['validation'],\n","    compute_metrics = compute_metrics_for_regression,\n","    callbacks=[EarlyStoppingCallback(5, 0.0)]\n",")\n","\n","# Train the model\n","trainer.train()"],"metadata":{"id":"baBlLozYwsH9","executionInfo":{"status":"ok","timestamp":1684925181878,"user_tz":-120,"elapsed":110013,"user":{"displayName":"CARLOS RODRIGUEZ CALZADA","userId":"12667430431079591890"}},"colab":{"base_uri":"https://localhost:8080/"},"outputId":"b518eead-9fc4-4702-e23c-715f0853d1a1"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stderr","text":["/usr/local/lib/python3.10/dist-packages/transformers/optimization.py:407: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning\n","  warnings.warn(\n"]},{"output_type":"stream","name":"stdout","text":["{'eval_loss': 0.2161165326833725, 'eval_mse': 0.2161165177822113, 'eval_rmse': 0.46488332748413086, 'eval_mae': 0.36528632044792175, 'eval_r2': -0.4673461379125028, 'eval_smape': 90.97666422526041, 'eval_runtime': 0.2449, 'eval_samples_per_second': 73.513, 'eval_steps_per_second': 12.252, 'epoch': 1.0}\n","{'eval_loss': 0.14834542572498322, 'eval_mse': 0.1483454406261444, 'eval_rmse': 0.38515639305114746, 'eval_mae': 0.36136069893836975, 'eval_r2': -0.007207035296832753, 'eval_smape': 78.9513210720486, 'eval_runtime': 0.2435, 'eval_samples_per_second': 73.932, 'eval_steps_per_second': 12.322, 'epoch': 2.0}\n","{'eval_loss': 0.14379286766052246, 'eval_mse': 0.14379285275936127, 'eval_rmse': 0.379200279712677, 'eval_mae': 0.3523784875869751, 'eval_r2': 0.023703107096517684, 'eval_smape': 78.87268744574652, 'eval_runtime': 0.2587, 'eval_samples_per_second': 69.577, 'eval_steps_per_second': 11.596, 'epoch': 3.0}\n","{'eval_loss': 0.13875378668308258, 'eval_mse': 0.1387537717819214, 'eval_rmse': 0.37249666452407837, 'eval_mae': 0.3429313004016876, 'eval_r2': 0.05791652973151906, 'eval_smape': 79.47755940755208, 'eval_runtime': 0.2502, 'eval_samples_per_second': 71.94, 'eval_steps_per_second': 11.99, 'epoch': 4.0}\n","{'eval_loss': 0.13077224791049957, 'eval_mse': 0.13077224791049957, 'eval_rmse': 0.36162444949150085, 'eval_mae': 0.3425130844116211, 'eval_r2': 0.1121079930101968, 'eval_smape': 80.13336859809027, 'eval_runtime': 0.2468, 'eval_samples_per_second': 72.922, 'eval_steps_per_second': 12.154, 'epoch': 5.0}\n","{'eval_loss': 0.12630023062229156, 'eval_mse': 0.12630024552345276, 'eval_rmse': 0.35538744926452637, 'eval_mae': 0.33980655670166016, 'eval_r2': 0.14247110461984902, 'eval_smape': 79.76445855034721, 'eval_runtime': 0.2593, 'eval_samples_per_second': 69.428, 'eval_steps_per_second': 11.571, 'epoch': 6.0}\n","{'train_runtime': 110.6502, 'train_samples_per_second': 16.539, 'train_steps_per_second': 2.169, 'train_loss': 0.1613027552763621, 'epoch': 6.0}\n"]},{"output_type":"execute_result","data":{"text/plain":["TrainOutput(global_step=96, training_loss=0.1613027552763621, metrics={'train_runtime': 110.6502, 'train_samples_per_second': 16.539, 'train_steps_per_second': 2.169, 'train_loss': 0.1613027552763621, 'epoch': 6.0})"]},"metadata":{},"execution_count":128}]},{"cell_type":"code","source":["trainer.evaluate()"],"metadata":{"id":"Mf19DwNAwutN","executionInfo":{"status":"ok","timestamp":1684925182164,"user_tz":-120,"elapsed":298,"user":{"displayName":"CARLOS RODRIGUEZ CALZADA","userId":"12667430431079591890"}},"colab":{"base_uri":"https://localhost:8080/"},"outputId":"aa5c69cc-c2ba-4b29-e69d-5bd30433e731"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["{'eval_loss': 0.2161165326833725, 'eval_mse': 0.2161165177822113, 'eval_rmse': 0.46488332748413086, 'eval_mae': 0.36528632044792175, 'eval_r2': -0.4673461379125028, 'eval_smape': 90.97666422526041, 'eval_runtime': 0.2953, 'eval_samples_per_second': 60.957, 'eval_steps_per_second': 10.159, 'epoch': 6.0}\n"]},{"output_type":"execute_result","data":{"text/plain":["{'eval_loss': 0.2161165326833725,\n"," 'eval_mse': 0.2161165177822113,\n"," 'eval_rmse': 0.46488332748413086,\n"," 'eval_mae': 0.36528632044792175,\n"," 'eval_r2': -0.4673461379125028,\n"," 'eval_smape': 90.97666422526041,\n"," 'eval_runtime': 0.2953,\n"," 'eval_samples_per_second': 60.957,\n"," 'eval_steps_per_second': 10.159,\n"," 'epoch': 6.0}"]},"metadata":{},"execution_count":129}]},{"cell_type":"code","source":["trainer.eval_dataset = data_encodings['test']\n","trainer.evaluate()"],"metadata":{"id":"8Nebpu_swxep","executionInfo":{"status":"ok","timestamp":1684925182694,"user_tz":-120,"elapsed":532,"user":{"displayName":"CARLOS RODRIGUEZ CALZADA","userId":"12667430431079591890"}},"colab":{"base_uri":"https://localhost:8080/"},"outputId":"2887a3eb-7db8-4e54-ea00-ef799305798d"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["{'eval_loss': 0.2335960417985916, 'eval_mse': 0.2335960417985916, 'eval_rmse': 0.4833177328109741, 'eval_mae': 0.4197189211845398, 'eval_r2': -0.7945260486070225, 'eval_smape': 102.99330357142857, 'eval_runtime': 0.4804, 'eval_samples_per_second': 72.862, 'eval_steps_per_second': 10.409, 'epoch': 6.0}\n"]},{"output_type":"execute_result","data":{"text/plain":["{'eval_loss': 0.2335960417985916,\n"," 'eval_mse': 0.2335960417985916,\n"," 'eval_rmse': 0.4833177328109741,\n"," 'eval_mae': 0.4197189211845398,\n"," 'eval_r2': -0.7945260486070225,\n"," 'eval_smape': 102.99330357142857,\n"," 'eval_runtime': 0.4804,\n"," 'eval_samples_per_second': 72.862,\n"," 'eval_steps_per_second': 10.409,\n"," 'epoch': 6.0}"]},"metadata":{},"execution_count":130}]},{"cell_type":"code","source":["def get_prediction(text):\n","    # prepare our text into tokenized sequence\n","    inputs = tokenizer(text, max_length=MAX_LEN, padding=\"max_length\", truncation=True, return_tensors=\"pt\").to(\"cuda\")\n","    outputs = model(**inputs)   #output is a tensor\n","    return outputs[0].item()    #we only have to return the value of the tensor by using item()"],"metadata":{"id":"SZbzOylrwzH9"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["y_pred_test=[get_prediction(text) for text in dataset['test']['Text']]"],"metadata":{"id":"f_5Pjn6Yw0mZ"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["y_pred_val=[get_prediction(text) for text in dataset['validation']['Text']]"],"metadata":{"id":"IK7O_EizyOiL"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["# from sklearn.metrics import explained_variance_score\n","\n","def print_metrics(y_test, y_pred, lang=''):\n","    # print(\"Final results on the whole test dataset\")\n","    print('|   |MSE|RMSE|MAE|R2|SMAPE|PEARSON|')\n","    print('|---|---|---|---|---|---|---|')\n","\n","    mse = mean_squared_error(y_test, y_pred)\n","    # print (\"MSE: \", \"{:.2f}\".format(mse), end=', ')\n","\n","    rmse = np.sqrt(mean_squared_error(y_test, y_pred))\n","    # print(\"RMSE: \", \"{:.2f}\".format(rmse), end=', ')\n","\n","    mae = mean_absolute_error(y_test, y_pred)\n","    # print(\"MAE: \", \"{:.2f}\".format(mae), end=', ')\n","\n","    r2 = r2_score(y_test, y_pred)\n","    # print(\"R2: \", \"{:.2f}\".format(r2), end=', ')\n","\n","    diff=[label-pred for (label,pred) in zip(y_test,y_pred)]\n","    smape= 1/len(y_test) * np.sum(2 * np.abs(diff) / (np.abs(y_test) + np.abs(y_pred))*100)\n","    # print(\"SMAPE: \", \"{:.2f}\".format(smape), end=', ')\n","\n","    pearson=stats.pearsonr(y_test, y_pred)[0]\n","    # print(\"PEARSON: \", \"{:.2f}\".format(pearson))\n","    # print()\n","\n","    text_table=str('|')+lang+str('|') +\"{:.2f}\".format(mse) \\\n","                +str('|')+\"{:.2f}\".format(rmse) \\\n","                +str('|')+\"{:.2f}\".format(mae) \\\n","                +str('|')+\"{:.2f}\".format(r2) \\\n","                +str('|')+\"{:.2f}\".format(smape) \\\n","                +str('|')+\"{:.2f}\".format(pearson) + str('|')\n","\n","    print(text_table)\n","    # print()\n"],"metadata":{"id":"O77RpRDow2sp"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["y_train = data_encodings['train']['label']\n","y_val = data_encodings['validation']['label']\n","y_test = data_encodings['test']['label']"],"metadata":{"id":"NardrTCEtfO7"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["print_metrics(y_val, y_pred_val)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"vZb8IEGUytld","executionInfo":{"status":"ok","timestamp":1684925183912,"user_tz":-120,"elapsed":6,"user":{"displayName":"CARLOS RODRIGUEZ CALZADA","userId":"12667430431079591890"}},"outputId":"970e498c-4754-43ff-a1a3-05d27316e25b"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["|   |MSE|RMSE|MAE|R2|SMAPE|PEARSON|\n","|---|---|---|---|---|---|---|\n","||0.22|0.46|0.37|-0.47|90.98|0.25|\n"]}]}]}