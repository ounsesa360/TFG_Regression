{"nbformat":4,"nbformat_minor":0,"metadata":{"colab":{"provenance":[],"authorship_tag":"ABX9TyOaFR2/SeW0JMQuKJwVqsZw"},"kernelspec":{"name":"python3","display_name":"Python 3"},"language_info":{"name":"python"},"accelerator":"GPU","gpuClass":"standard","widgets":{"application/vnd.jupyter.widget-state+json":{"8114b4e8f98d4948894946ab4dd7bece":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_cb22a0d819d34892b2eb65ac2050c581","IPY_MODEL_8d782a692a0d4979973ad3ac57b82eb3","IPY_MODEL_ec347e33291a4ca4a8fe79ff0f6eb552"],"layout":"IPY_MODEL_3f2655d7c14d4572970d826dba858f6d"}},"cb22a0d819d34892b2eb65ac2050c581":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_176781f91fb24ca3a1805b060091e861","placeholder":"​","style":"IPY_MODEL_591f64e1ccd548faa2b7916b0dd6feee","value":"100%"}},"8d782a692a0d4979973ad3ac57b82eb3":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_5281c06d6c914f518fb3b25f5a0495d8","max":1,"min":0,"orientation":"horizontal","style":"IPY_MODEL_a75705880f38484b91ab74236125e8aa","value":1}},"ec347e33291a4ca4a8fe79ff0f6eb552":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_db12ac8643514cb78d51c200484aa31d","placeholder":"​","style":"IPY_MODEL_fbf3961716aa44728db66c705a0e0d21","value":" 1/1 [00:00&lt;00:00, 52.04it/s]"}},"3f2655d7c14d4572970d826dba858f6d":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"176781f91fb24ca3a1805b060091e861":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"591f64e1ccd548faa2b7916b0dd6feee":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"5281c06d6c914f518fb3b25f5a0495d8":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"a75705880f38484b91ab74236125e8aa":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"db12ac8643514cb78d51c200484aa31d":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"fbf3961716aa44728db66c705a0e0d21":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"0e229c18998942888b7017461a9ad94a":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_ddde07412d464f4fbf201d70bf8ae301","IPY_MODEL_47699ecfe1224471a61bef35d713b0d2","IPY_MODEL_97bc2b6090674e68b08dcd758b9cf454"],"layout":"IPY_MODEL_ec5cce36243e43b1b3716bbdfb7f37d5"}},"ddde07412d464f4fbf201d70bf8ae301":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_f5048735ba004395859b5fec60563cb4","placeholder":"​","style":"IPY_MODEL_9c5db9100b5c4add86b1dccf17c2d902","value":"Map: 100%"}},"47699ecfe1224471a61bef35d713b0d2":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"","description":"","description_tooltip":null,"layout":"IPY_MODEL_beb3e7372ccf45f08c892e8efd6161c9","max":463,"min":0,"orientation":"horizontal","style":"IPY_MODEL_c25e71612c5f419fbac9c5773b47fec2","value":463}},"97bc2b6090674e68b08dcd758b9cf454":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_74c185fa65324cf6a17765f511cc37be","placeholder":"​","style":"IPY_MODEL_129f5d2ebca041888bd6d5bf14b6da96","value":" 463/463 [00:00&lt;00:00, 2995.77 examples/s]"}},"ec5cce36243e43b1b3716bbdfb7f37d5":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":"hidden","width":null}},"f5048735ba004395859b5fec60563cb4":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"9c5db9100b5c4add86b1dccf17c2d902":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"beb3e7372ccf45f08c892e8efd6161c9":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"c25e71612c5f419fbac9c5773b47fec2":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"74c185fa65324cf6a17765f511cc37be":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"129f5d2ebca041888bd6d5bf14b6da96":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"96c5e5b088dc416392f3603ae8f013bf":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_2fa6dbae34c04b3995fc71e46b68963f","IPY_MODEL_ea0011f286364db99e9c62600b98274c","IPY_MODEL_a8a6eb83d708479aaa69424cf7142f8a"],"layout":"IPY_MODEL_f53956583d7349c79bdae23f66b38aa2"}},"2fa6dbae34c04b3995fc71e46b68963f":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_882036e606a34bd79f7881391bf61a98","placeholder":"​","style":"IPY_MODEL_50ef6f562c5342b391a4726b5c5d62f0","value":"Downloading (…)lve/main/config.json: 100%"}},"ea0011f286364db99e9c62600b98274c":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_6e580010da4e4aeab8bcdbcbdbb86934","max":430,"min":0,"orientation":"horizontal","style":"IPY_MODEL_9bb5a426e845454c8632f89ca34c77d0","value":430}},"a8a6eb83d708479aaa69424cf7142f8a":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_008200621d3d4d66a6f01dc84c66bc34","placeholder":"​","style":"IPY_MODEL_f5ae30fbb868476bb37d53c98a5c1d55","value":" 430/430 [00:00&lt;00:00, 26.2kB/s]"}},"f53956583d7349c79bdae23f66b38aa2":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"882036e606a34bd79f7881391bf61a98":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"50ef6f562c5342b391a4726b5c5d62f0":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"6e580010da4e4aeab8bcdbcbdbb86934":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"9bb5a426e845454c8632f89ca34c77d0":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"008200621d3d4d66a6f01dc84c66bc34":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"f5ae30fbb868476bb37d53c98a5c1d55":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"e9d4177a5713421f948ed38a8d0338a9":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_6ff0116e67ae4fcb95b42f104e97a5bc","IPY_MODEL_2d132d2dc7ea44dab644793823eec3f4","IPY_MODEL_921f1ecfd6b5485a9cd34018186e15fd"],"layout":"IPY_MODEL_1eac962d8e0e4e95860522ad6e004fe1"}},"6ff0116e67ae4fcb95b42f104e97a5bc":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_0cfbfdc4530c4c3b894720dad31881a2","placeholder":"​","style":"IPY_MODEL_ff496207f006456f84fde66ecdcbc7e4","value":"Downloading pytorch_model.bin: 100%"}},"2d132d2dc7ea44dab644793823eec3f4":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_eb687552bf4c4deba545cd32630d38f5","max":470657952,"min":0,"orientation":"horizontal","style":"IPY_MODEL_1a49b61d023d499aa486cbfdd810a6ca","value":470657952}},"921f1ecfd6b5485a9cd34018186e15fd":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_a6ab645175ba44fcb7c70a6c33df459b","placeholder":"​","style":"IPY_MODEL_57c58ed889aa4db89b148dcfc44e5f11","value":" 471M/471M [00:01&lt;00:00, 267MB/s]"}},"1eac962d8e0e4e95860522ad6e004fe1":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"0cfbfdc4530c4c3b894720dad31881a2":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"ff496207f006456f84fde66ecdcbc7e4":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"eb687552bf4c4deba545cd32630d38f5":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"1a49b61d023d499aa486cbfdd810a6ca":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"a6ab645175ba44fcb7c70a6c33df459b":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"57c58ed889aa4db89b148dcfc44e5f11":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}}}}},"cells":[{"cell_type":"code","execution_count":85,"metadata":{"id":"_BiM0RepL_H6","executionInfo":{"status":"ok","timestamp":1684707212415,"user_tz":-120,"elapsed":2553,"user":{"displayName":"CARLOS RODRIGUEZ CALZADA","userId":"12667430431079591890"}},"colab":{"base_uri":"https://localhost:8080/"},"outputId":"f0fd3564-e92b-4c42-d890-f96d723b00e5"},"outputs":[{"output_type":"stream","name":"stdout","text":["Drive already mounted at /content/drive; to attempt to forcibly remount, call drive.mount(\"/content/drive\", force_remount=True).\n"]}],"source":["from google.colab import drive\n","drive.mount('/content/drive')"]},{"cell_type":"code","source":["!pip install datasets transformers accelerate"],"metadata":{"id":"wCWqtrBkuBp9","executionInfo":{"status":"ok","timestamp":1684707222620,"user_tz":-120,"elapsed":10206,"user":{"displayName":"CARLOS RODRIGUEZ CALZADA","userId":"12667430431079591890"}},"colab":{"base_uri":"https://localhost:8080/"},"outputId":"8f61b441-6b73-4332-9c72-1ceec10f2ca3"},"execution_count":86,"outputs":[{"output_type":"stream","name":"stdout","text":["Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/\n","Requirement already satisfied: datasets in /usr/local/lib/python3.10/dist-packages (2.12.0)\n","Requirement already satisfied: transformers in /usr/local/lib/python3.10/dist-packages (4.29.2)\n","Requirement already satisfied: accelerate in /usr/local/lib/python3.10/dist-packages (0.19.0)\n","Requirement already satisfied: numpy>=1.17 in /usr/local/lib/python3.10/dist-packages (from datasets) (1.22.4)\n","Requirement already satisfied: pyarrow>=8.0.0 in /usr/local/lib/python3.10/dist-packages (from datasets) (9.0.0)\n","Requirement already satisfied: dill<0.3.7,>=0.3.0 in /usr/local/lib/python3.10/dist-packages (from datasets) (0.3.6)\n","Requirement already satisfied: pandas in /usr/local/lib/python3.10/dist-packages (from datasets) (1.5.3)\n","Requirement already satisfied: requests>=2.19.0 in /usr/local/lib/python3.10/dist-packages (from datasets) (2.27.1)\n","Requirement already satisfied: tqdm>=4.62.1 in /usr/local/lib/python3.10/dist-packages (from datasets) (4.65.0)\n","Requirement already satisfied: xxhash in /usr/local/lib/python3.10/dist-packages (from datasets) (3.2.0)\n","Requirement already satisfied: multiprocess in /usr/local/lib/python3.10/dist-packages (from datasets) (0.70.14)\n","Requirement already satisfied: fsspec[http]>=2021.11.1 in /usr/local/lib/python3.10/dist-packages (from datasets) (2023.4.0)\n","Requirement already satisfied: aiohttp in /usr/local/lib/python3.10/dist-packages (from datasets) (3.8.4)\n","Requirement already satisfied: huggingface-hub<1.0.0,>=0.11.0 in /usr/local/lib/python3.10/dist-packages (from datasets) (0.14.1)\n","Requirement already satisfied: packaging in /usr/local/lib/python3.10/dist-packages (from datasets) (23.1)\n","Requirement already satisfied: responses<0.19 in /usr/local/lib/python3.10/dist-packages (from datasets) (0.18.0)\n","Requirement already satisfied: pyyaml>=5.1 in /usr/local/lib/python3.10/dist-packages (from datasets) (6.0)\n","Requirement already satisfied: filelock in /usr/local/lib/python3.10/dist-packages (from transformers) (3.12.0)\n","Requirement already satisfied: regex!=2019.12.17 in /usr/local/lib/python3.10/dist-packages (from transformers) (2022.10.31)\n","Requirement already satisfied: tokenizers!=0.11.3,<0.14,>=0.11.1 in /usr/local/lib/python3.10/dist-packages (from transformers) (0.13.3)\n","Requirement already satisfied: psutil in /usr/local/lib/python3.10/dist-packages (from accelerate) (5.9.5)\n","Requirement already satisfied: torch>=1.6.0 in /usr/local/lib/python3.10/dist-packages (from accelerate) (2.0.1+cu118)\n","Requirement already satisfied: attrs>=17.3.0 in /usr/local/lib/python3.10/dist-packages (from aiohttp->datasets) (23.1.0)\n","Requirement already satisfied: charset-normalizer<4.0,>=2.0 in /usr/local/lib/python3.10/dist-packages (from aiohttp->datasets) (2.0.12)\n","Requirement already satisfied: multidict<7.0,>=4.5 in /usr/local/lib/python3.10/dist-packages (from aiohttp->datasets) (6.0.4)\n","Requirement already satisfied: async-timeout<5.0,>=4.0.0a3 in /usr/local/lib/python3.10/dist-packages (from aiohttp->datasets) (4.0.2)\n","Requirement already satisfied: yarl<2.0,>=1.0 in /usr/local/lib/python3.10/dist-packages (from aiohttp->datasets) (1.9.2)\n","Requirement already satisfied: frozenlist>=1.1.1 in /usr/local/lib/python3.10/dist-packages (from aiohttp->datasets) (1.3.3)\n","Requirement already satisfied: aiosignal>=1.1.2 in /usr/local/lib/python3.10/dist-packages (from aiohttp->datasets) (1.3.1)\n","Requirement already satisfied: typing-extensions>=3.7.4.3 in /usr/local/lib/python3.10/dist-packages (from huggingface-hub<1.0.0,>=0.11.0->datasets) (4.5.0)\n","Requirement already satisfied: urllib3<1.27,>=1.21.1 in /usr/local/lib/python3.10/dist-packages (from requests>=2.19.0->datasets) (1.26.15)\n","Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.10/dist-packages (from requests>=2.19.0->datasets) (2022.12.7)\n","Requirement already satisfied: idna<4,>=2.5 in /usr/local/lib/python3.10/dist-packages (from requests>=2.19.0->datasets) (3.4)\n","Requirement already satisfied: sympy in /usr/local/lib/python3.10/dist-packages (from torch>=1.6.0->accelerate) (1.11.1)\n","Requirement already satisfied: networkx in /usr/local/lib/python3.10/dist-packages (from torch>=1.6.0->accelerate) (3.1)\n","Requirement already satisfied: jinja2 in /usr/local/lib/python3.10/dist-packages (from torch>=1.6.0->accelerate) (3.1.2)\n","Requirement already satisfied: triton==2.0.0 in /usr/local/lib/python3.10/dist-packages (from torch>=1.6.0->accelerate) (2.0.0)\n","Requirement already satisfied: cmake in /usr/local/lib/python3.10/dist-packages (from triton==2.0.0->torch>=1.6.0->accelerate) (3.25.2)\n","Requirement already satisfied: lit in /usr/local/lib/python3.10/dist-packages (from triton==2.0.0->torch>=1.6.0->accelerate) (16.0.5)\n","Requirement already satisfied: python-dateutil>=2.8.1 in /usr/local/lib/python3.10/dist-packages (from pandas->datasets) (2.8.2)\n","Requirement already satisfied: pytz>=2020.1 in /usr/local/lib/python3.10/dist-packages (from pandas->datasets) (2022.7.1)\n","Requirement already satisfied: six>=1.5 in /usr/local/lib/python3.10/dist-packages (from python-dateutil>=2.8.1->pandas->datasets) (1.16.0)\n","Requirement already satisfied: MarkupSafe>=2.0 in /usr/local/lib/python3.10/dist-packages (from jinja2->torch>=1.6.0->accelerate) (2.1.2)\n","Requirement already satisfied: mpmath>=0.19 in /usr/local/lib/python3.10/dist-packages (from sympy->torch>=1.6.0->accelerate) (1.3.0)\n"]}]},{"cell_type":"code","source":["gpu_info = !nvidia-smi\n","gpu_info = '\\n'.join(gpu_info)\n","if gpu_info.find('failed') >= 0:\n","  print('Not connected to a GPU')\n","else:\n","  print(gpu_info)"],"metadata":{"id":"13dCqvZhuxs_","executionInfo":{"status":"ok","timestamp":1684707222621,"user_tz":-120,"elapsed":9,"user":{"displayName":"CARLOS RODRIGUEZ CALZADA","userId":"12667430431079591890"}},"colab":{"base_uri":"https://localhost:8080/"},"outputId":"a47345f6-0870-4747-8b9b-8c378372bd38"},"execution_count":87,"outputs":[{"output_type":"stream","name":"stdout","text":["Sun May 21 22:13:41 2023       \n","+-----------------------------------------------------------------------------+\n","| NVIDIA-SMI 525.85.12    Driver Version: 525.85.12    CUDA Version: 12.0     |\n","|-------------------------------+----------------------+----------------------+\n","| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |\n","| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |\n","|                               |                      |               MIG M. |\n","|===============================+======================+======================|\n","|   0  Tesla T4            Off  | 00000000:00:04.0 Off |                    0 |\n","| N/A   75C    P0    32W /  70W |   3295MiB / 15360MiB |      0%      Default |\n","|                               |                      |                  N/A |\n","+-------------------------------+----------------------+----------------------+\n","                                                                               \n","+-----------------------------------------------------------------------------+\n","| Processes:                                                                  |\n","|  GPU   GI   CI        PID   Type   Process name                  GPU Memory |\n","|        ID   ID                                                   Usage      |\n","|=============================================================================|\n","+-----------------------------------------------------------------------------+\n"]}]},{"cell_type":"code","source":["import transformers, datasets\n","transformers.logging.set_verbosity_error()\n","datasets.logging.set_verbosity_error()"],"metadata":{"id":"4evkaVy1u46V","executionInfo":{"status":"ok","timestamp":1684707222621,"user_tz":-120,"elapsed":3,"user":{"displayName":"CARLOS RODRIGUEZ CALZADA","userId":"12667430431079591890"}}},"execution_count":88,"outputs":[]},{"cell_type":"code","source":["from datasets import load_dataset\n","\n","data_path = \"/content/drive/My Drive/TFG/MentalRiskES/train/Task 1/Sentiment Analysis/\"\n","dataset = load_dataset(\"csv\", data_files=data_path+\"train_sentiment_no_neutro_beto.csv\")\n","dataset"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":175,"referenced_widgets":["8114b4e8f98d4948894946ab4dd7bece","cb22a0d819d34892b2eb65ac2050c581","8d782a692a0d4979973ad3ac57b82eb3","ec347e33291a4ca4a8fe79ff0f6eb552","3f2655d7c14d4572970d826dba858f6d","176781f91fb24ca3a1805b060091e861","591f64e1ccd548faa2b7916b0dd6feee","5281c06d6c914f518fb3b25f5a0495d8","a75705880f38484b91ab74236125e8aa","db12ac8643514cb78d51c200484aa31d","fbf3961716aa44728db66c705a0e0d21"]},"id":"FMiyJWAHMa4-","executionInfo":{"status":"ok","timestamp":1684707223153,"user_tz":-120,"elapsed":535,"user":{"displayName":"CARLOS RODRIGUEZ CALZADA","userId":"12667430431079591890"}},"outputId":"14da5fcc-0fd9-480b-bfde-a35325275932"},"execution_count":89,"outputs":[{"output_type":"display_data","data":{"text/plain":["  0%|          | 0/1 [00:00<?, ?it/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"8114b4e8f98d4948894946ab4dd7bece"}},"metadata":{}},{"output_type":"execute_result","data":{"text/plain":["DatasetDict({\n","    train: Dataset({\n","        features: ['Unnamed: 0.1', 'Unnamed: 0', 'Message', 'Subject', 'label beto', 'score beto', 'label robertuito', 'score robertuito', 'label'],\n","        num_rows: 2306\n","    })\n","})"]},"metadata":{},"execution_count":89}]},{"cell_type":"code","source":["dataset = dataset[\"train\"].train_test_split(test_size=0.3, seed=42)\n","print(dataset)\n","\n","aux_dataset = dataset[\"test\"].train_test_split(test_size=0.33, seed=42)\n","print(aux_dataset)\n","\n","dataset['validation']=aux_dataset['test']\n","dataset['test']=aux_dataset['train']\n","del(aux_dataset)\n","print(dataset)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"0SxeW28IM7Va","executionInfo":{"status":"ok","timestamp":1684707223154,"user_tz":-120,"elapsed":10,"user":{"displayName":"CARLOS RODRIGUEZ CALZADA","userId":"12667430431079591890"}},"outputId":"c002932a-319a-4a21-927b-3131bdf8df5c"},"execution_count":90,"outputs":[{"output_type":"stream","name":"stdout","text":["DatasetDict({\n","    train: Dataset({\n","        features: ['Unnamed: 0.1', 'Unnamed: 0', 'Message', 'Subject', 'label beto', 'score beto', 'label robertuito', 'score robertuito', 'label'],\n","        num_rows: 1614\n","    })\n","    test: Dataset({\n","        features: ['Unnamed: 0.1', 'Unnamed: 0', 'Message', 'Subject', 'label beto', 'score beto', 'label robertuito', 'score robertuito', 'label'],\n","        num_rows: 692\n","    })\n","})\n","DatasetDict({\n","    train: Dataset({\n","        features: ['Unnamed: 0.1', 'Unnamed: 0', 'Message', 'Subject', 'label beto', 'score beto', 'label robertuito', 'score robertuito', 'label'],\n","        num_rows: 463\n","    })\n","    test: Dataset({\n","        features: ['Unnamed: 0.1', 'Unnamed: 0', 'Message', 'Subject', 'label beto', 'score beto', 'label robertuito', 'score robertuito', 'label'],\n","        num_rows: 229\n","    })\n","})\n","DatasetDict({\n","    train: Dataset({\n","        features: ['Unnamed: 0.1', 'Unnamed: 0', 'Message', 'Subject', 'label beto', 'score beto', 'label robertuito', 'score robertuito', 'label'],\n","        num_rows: 1614\n","    })\n","    test: Dataset({\n","        features: ['Unnamed: 0.1', 'Unnamed: 0', 'Message', 'Subject', 'label beto', 'score beto', 'label robertuito', 'score robertuito', 'label'],\n","        num_rows: 463\n","    })\n","    validation: Dataset({\n","        features: ['Unnamed: 0.1', 'Unnamed: 0', 'Message', 'Subject', 'label beto', 'score beto', 'label robertuito', 'score robertuito', 'label'],\n","        num_rows: 229\n","    })\n","})\n"]}]},{"cell_type":"code","source":["data_validation = dataset[\"validation\"]"],"metadata":{"id":"qKUgPZR1ojiB","executionInfo":{"status":"ok","timestamp":1684707223154,"user_tz":-120,"elapsed":8,"user":{"displayName":"CARLOS RODRIGUEZ CALZADA","userId":"12667430431079591890"}}},"execution_count":91,"outputs":[]},{"cell_type":"code","source":["dataset['train'][0]"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"2Z_fyU-Eunev","executionInfo":{"status":"ok","timestamp":1684707223154,"user_tz":-120,"elapsed":8,"user":{"displayName":"CARLOS RODRIGUEZ CALZADA","userId":"12667430431079591890"}},"outputId":"7f026e65-bc59-47eb-ab86-1bb32671ed0c"},"execution_count":92,"outputs":[{"output_type":"execute_result","data":{"text/plain":["{'Unnamed: 0.1': 0,\n"," 'Unnamed: 0': 4088,\n"," 'Message': 'Me metéis en unos embolaos sin yo estar aquí',\n"," 'Subject': 'subject208',\n"," 'label beto': 'NEG',\n"," 'score beto': 0.9992974996566772,\n"," 'label robertuito': 'NEG',\n"," 'score robertuito': 0.9722928404808044,\n"," 'label': 0.0}"]},"metadata":{},"execution_count":92}]},{"cell_type":"code","source":["# MODEL_NAME='bert-base-multilingual-uncased'\n","\n","# XLM-T: This is a XLM-Roberta-base model trained on ~198M multilingual tweets\n","# MODEL_NAME= \"cardiffnlp/twitter-xlm-roberta-base\"\n","\n","# XLM-R: XLM-RoBERTa model pre-trained on 2.5TB of filtered CommonCrawl data containing 100 languages.\n","# MODEL_NAME= \"xlm-roberta-base\"\n","\n","# DistillBERT: a distilled version of the BERT base multilingual model. The model is trained on the concatenation of Wikipedia in 104 different languages\n","# The model has 6 layers, 768 dimension and 12 heads, totalizing 134M parameters (compared to 177M parameters for mBERT-base). \n","# On average, this model, referred to as DistilmBERT, is twice as fast as mBERT-base.\n","# MODEL_NAME= \"distilbert-base-multilingual-cased\"\n","\n","# MiniLM:Multilingual MiniLM uses the same tokenizer as XLM-R\n","MODEL_NAME= \"microsoft/Multilingual-MiniLM-L12-H384\"\n","\n","print('Using model:', MODEL_NAME)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"-MuWGUZOvBJu","executionInfo":{"status":"ok","timestamp":1684711157997,"user_tz":-120,"elapsed":5,"user":{"displayName":"CARLOS RODRIGUEZ CALZADA","userId":"12667430431079591890"}},"outputId":"51b097fd-08ad-412f-debc-9eb6fca8588d"},"execution_count":184,"outputs":[{"output_type":"stream","name":"stdout","text":["Using model: microsoft/Multilingual-MiniLM-L12-H384\n"]}]},{"cell_type":"code","source":["from transformers import AutoTokenizer\n","\n","if 'MiniLM' in MODEL_NAME:\n","    # we must load the tokenizer of XLM-R\n","    tokenizer = AutoTokenizer.from_pretrained(\"xlm-roberta-base\")\n","else: \n","    tokenizer = AutoTokenizer.from_pretrained(MODEL_NAME)\n"],"metadata":{"id":"ljpBXXWTvF6b","executionInfo":{"status":"ok","timestamp":1684711160563,"user_tz":-120,"elapsed":2568,"user":{"displayName":"CARLOS RODRIGUEZ CALZADA","userId":"12667430431079591890"}}},"execution_count":185,"outputs":[]},{"cell_type":"code","source":["len_train_texts = [len(tokenizer(text).input_ids) for text in dataset['train']['Message']]\n","\n","import pandas as pd\n","df=pd.Series(len_train_texts)\n","df.describe(percentiles=[0.25, 0.50, 0.75, 0.85, 0.90, 0.95, 0.99])"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"Fo_-iSvrvIfk","executionInfo":{"status":"ok","timestamp":1684711161110,"user_tz":-120,"elapsed":549,"user":{"displayName":"CARLOS RODRIGUEZ CALZADA","userId":"12667430431079591890"}},"outputId":"cd73d9f6-4e00-40e3-b036-85089b35681a"},"execution_count":186,"outputs":[{"output_type":"execute_result","data":{"text/plain":["count    1614.000000\n","mean       22.916357\n","std        52.010036\n","min         5.000000\n","25%        10.000000\n","50%        15.000000\n","75%        23.000000\n","85%        30.000000\n","90%        37.000000\n","95%        51.350000\n","99%       135.090000\n","max      1200.000000\n","dtype: float64"]},"metadata":{},"execution_count":186}]},{"cell_type":"code","source":["MAX_LEN = 50\n","\n","def tokenize(examples):\n","    ## it applies the tokenizer on the dataset in its field text\n","    # we could add max_length = MAX_LENGHT, but in this case is not neccesary because MAX_LENGTH is already 512, the maximum length allowed by the model\n","    return tokenizer(examples[\"Message\"], truncation=True, max_length=MAX_LEN, padding='max_length')\n","\n","\n","data_encodings=dataset.map(tokenize, batched=True)\n","data_encodings"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":322,"referenced_widgets":["0e229c18998942888b7017461a9ad94a","ddde07412d464f4fbf201d70bf8ae301","47699ecfe1224471a61bef35d713b0d2","97bc2b6090674e68b08dcd758b9cf454","ec5cce36243e43b1b3716bbdfb7f37d5","f5048735ba004395859b5fec60563cb4","9c5db9100b5c4add86b1dccf17c2d902","beb3e7372ccf45f08c892e8efd6161c9","c25e71612c5f419fbac9c5773b47fec2","74c185fa65324cf6a17765f511cc37be","129f5d2ebca041888bd6d5bf14b6da96"]},"id":"MkV_0THcvUVE","executionInfo":{"status":"ok","timestamp":1684711161111,"user_tz":-120,"elapsed":20,"user":{"displayName":"CARLOS RODRIGUEZ CALZADA","userId":"12667430431079591890"}},"outputId":"4cce9686-4ecf-41c7-abf3-28eba12e59fd"},"execution_count":187,"outputs":[{"output_type":"display_data","data":{"text/plain":["Map:   0%|          | 0/463 [00:00<?, ? examples/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"0e229c18998942888b7017461a9ad94a"}},"metadata":{}},{"output_type":"execute_result","data":{"text/plain":["DatasetDict({\n","    train: Dataset({\n","        features: ['Unnamed: 0.1', 'Unnamed: 0', 'Message', 'Subject', 'label beto', 'score beto', 'label robertuito', 'score robertuito', 'label', 'input_ids', 'attention_mask'],\n","        num_rows: 1614\n","    })\n","    test: Dataset({\n","        features: ['Unnamed: 0.1', 'Unnamed: 0', 'Message', 'Subject', 'label beto', 'score beto', 'label robertuito', 'score robertuito', 'label', 'input_ids', 'attention_mask'],\n","        num_rows: 463\n","    })\n","    validation: Dataset({\n","        features: ['Unnamed: 0.1', 'Unnamed: 0', 'Message', 'Subject', 'label beto', 'score beto', 'label robertuito', 'score robertuito', 'label', 'input_ids', 'attention_mask'],\n","        num_rows: 229\n","    })\n","})"]},"metadata":{},"execution_count":187}]},{"cell_type":"code","source":["data_encodings = data_encodings.remove_columns(['Unnamed: 0.1','Unnamed: 0','Subject','Message', 'label beto', 'score beto', 'label robertuito', 'score robertuito'])\n","data_encodings"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"_A3LcmxMwgo4","executionInfo":{"status":"ok","timestamp":1684711161111,"user_tz":-120,"elapsed":17,"user":{"displayName":"CARLOS RODRIGUEZ CALZADA","userId":"12667430431079591890"}},"outputId":"b1e91d21-db2c-4e69-f085-9b325009b0e7"},"execution_count":188,"outputs":[{"output_type":"execute_result","data":{"text/plain":["DatasetDict({\n","    train: Dataset({\n","        features: ['label', 'input_ids', 'attention_mask'],\n","        num_rows: 1614\n","    })\n","    test: Dataset({\n","        features: ['label', 'input_ids', 'attention_mask'],\n","        num_rows: 463\n","    })\n","    validation: Dataset({\n","        features: ['label', 'input_ids', 'attention_mask'],\n","        num_rows: 229\n","    })\n","})"]},"metadata":{},"execution_count":188}]},{"cell_type":"code","source":["from transformers import AutoModelForSequenceClassification\n","# As num_labes is 1, the AutoModelForSequenceClassification will trigger the linear regression and use MSELoss() as the loss function automatically.\n","model = AutoModelForSequenceClassification.from_pretrained(MODEL_NAME, num_labels = 1).to(\"cuda\")"],"metadata":{"id":"o4YciE87wXsR","executionInfo":{"status":"ok","timestamp":1684711166487,"user_tz":-120,"elapsed":5391,"user":{"displayName":"CARLOS RODRIGUEZ CALZADA","userId":"12667430431079591890"}},"colab":{"base_uri":"https://localhost:8080/","height":81,"referenced_widgets":["96c5e5b088dc416392f3603ae8f013bf","2fa6dbae34c04b3995fc71e46b68963f","ea0011f286364db99e9c62600b98274c","a8a6eb83d708479aaa69424cf7142f8a","f53956583d7349c79bdae23f66b38aa2","882036e606a34bd79f7881391bf61a98","50ef6f562c5342b391a4726b5c5d62f0","6e580010da4e4aeab8bcdbcbdbb86934","9bb5a426e845454c8632f89ca34c77d0","008200621d3d4d66a6f01dc84c66bc34","f5ae30fbb868476bb37d53c98a5c1d55","e9d4177a5713421f948ed38a8d0338a9","6ff0116e67ae4fcb95b42f104e97a5bc","2d132d2dc7ea44dab644793823eec3f4","921f1ecfd6b5485a9cd34018186e15fd","1eac962d8e0e4e95860522ad6e004fe1","0cfbfdc4530c4c3b894720dad31881a2","ff496207f006456f84fde66ecdcbc7e4","eb687552bf4c4deba545cd32630d38f5","1a49b61d023d499aa486cbfdd810a6ca","a6ab645175ba44fcb7c70a6c33df459b","57c58ed889aa4db89b148dcfc44e5f11"]},"outputId":"f45bc985-67d5-4d33-80e7-1cc38e032201"},"execution_count":189,"outputs":[{"output_type":"display_data","data":{"text/plain":["Downloading (…)lve/main/config.json:   0%|          | 0.00/430 [00:00<?, ?B/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"96c5e5b088dc416392f3603ae8f013bf"}},"metadata":{}},{"output_type":"display_data","data":{"text/plain":["Downloading pytorch_model.bin:   0%|          | 0.00/471M [00:00<?, ?B/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"e9d4177a5713421f948ed38a8d0338a9"}},"metadata":{}}]},{"cell_type":"code","source":["import numpy as np\n","from sklearn.metrics import mean_squared_error, r2_score, mean_squared_error, mean_absolute_error\n","from scipy import stats\n","\n","def compute_metrics_for_regression(eval_pred):\n","    logits, labels = eval_pred\n","    labels = labels.reshape(-1, 1)\n","\n","    # loss metrics\n","    mse = mean_squared_error(labels, logits)\n","    rmse = mean_squared_error(labels, logits, squared=False)\n","    mae = mean_absolute_error(labels, logits)\n","    smape = 1/len(labels) * np.sum(2 * np.abs(logits-labels) / (np.abs(labels) + np.abs(logits))*100)\n","    # performance metrics\n","    r2 = r2_score(labels, logits)\n","    # pearson=stats.pearsonr(labels, logits)[0]\n","\n","    # we return a dictionary with all metrics\n","    # return {\"mse\": mse, \"rmse\": rmse, \"mae\": mae, \"r2\": r2, \"smape\": smape, \"pearson\": pearson}\n","    return {\"mse\": mse, \"rmse\": rmse, \"mae\": mae, \"r2\": r2, \"smape\": smape}"],"metadata":{"id":"Kn79dWOFwZxe","executionInfo":{"status":"ok","timestamp":1684711166931,"user_tz":-120,"elapsed":4,"user":{"displayName":"CARLOS RODRIGUEZ CALZADA","userId":"12667430431079591890"}}},"execution_count":190,"outputs":[]},{"cell_type":"code","source":["from transformers import TrainingArguments\n","\n","\n","NUM_EPOCHS = 15 # we recommend at least 3\n","\n","# Specifiy the arguments for the trainer  \n","training_args = TrainingArguments(\n","    output_dir ='./results',          \n","    num_train_epochs = NUM_EPOCHS,     \n","    per_device_train_batch_size = 8, # 128 in the paper   \n","    per_device_eval_batch_size = 8,   \n","    weight_decay = 0.01,               \n","    learning_rate = 2e-5,  # 0.001 in the paper,\n","    logging_dir = './logs',            \n","    save_total_limit = 10,\n","    load_best_model_at_end = True,     \n","    metric_for_best_model = 'rmse',    \n","    evaluation_strategy = \"epoch\",  # steps in the paper\n","    save_strategy = \"epoch\",    # steps in the paper\n","    report_to = 'all',\n",") "],"metadata":{"id":"pL_uOTjYwcSY","executionInfo":{"status":"ok","timestamp":1684711166931,"user_tz":-120,"elapsed":3,"user":{"displayName":"CARLOS RODRIGUEZ CALZADA","userId":"12667430431079591890"}}},"execution_count":191,"outputs":[]},{"cell_type":"code","source":["from transformers import Trainer, EarlyStoppingCallback\n","\n","# Call the Trainer\n","trainer = Trainer(\n","    model = model,                         \n","    args = training_args,                  \n","    train_dataset = data_encodings['train'],         \n","    eval_dataset = data_encodings['validation'],          \n","    compute_metrics = compute_metrics_for_regression,    \n","    callbacks=[EarlyStoppingCallback(5, 0.0)] \n",")\n","\n","# Train the model\n","trainer.train()"],"metadata":{"id":"baBlLozYwsH9","executionInfo":{"status":"ok","timestamp":1684711506161,"user_tz":-120,"elapsed":339233,"user":{"displayName":"CARLOS RODRIGUEZ CALZADA","userId":"12667430431079591890"}},"colab":{"base_uri":"https://localhost:8080/"},"outputId":"557644c4-1450-47f5-9704-656ee241bf86"},"execution_count":192,"outputs":[{"output_type":"stream","name":"stderr","text":["/usr/local/lib/python3.10/dist-packages/transformers/optimization.py:407: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning\n","  warnings.warn(\n"]},{"output_type":"stream","name":"stdout","text":["{'eval_loss': 0.16765834391117096, 'eval_mse': 0.16765834391117096, 'eval_rmse': 0.40946105122566223, 'eval_mae': 0.3591507077217102, 'eval_r2': 0.020781240772604015, 'eval_smape': 102.81873464792577, 'eval_runtime': 0.5206, 'eval_samples_per_second': 439.895, 'eval_steps_per_second': 55.707, 'epoch': 1.0}\n","{'eval_loss': 0.14540979266166687, 'eval_mse': 0.14540979266166687, 'eval_rmse': 0.3813263475894928, 'eval_mae': 0.3259996175765991, 'eval_r2': 0.15072521826600138, 'eval_smape': 96.84172011462881, 'eval_runtime': 0.4661, 'eval_samples_per_second': 491.262, 'eval_steps_per_second': 62.212, 'epoch': 2.0}\n","{'loss': 0.1634, 'learning_rate': 1.66996699669967e-05, 'epoch': 2.48}\n","{'eval_loss': 0.17049893736839294, 'eval_mse': 0.17049892246723175, 'eval_rmse': 0.4129151403903961, 'eval_mae': 0.3381241261959076, 'eval_r2': 0.004190518813581456, 'eval_smape': 93.24344978165938, 'eval_runtime': 0.3458, 'eval_samples_per_second': 662.231, 'eval_steps_per_second': 83.863, 'epoch': 3.0}\n","{'eval_loss': 0.1600620001554489, 'eval_mse': 0.16006197035312653, 'eval_rmse': 0.4000774621963501, 'eval_mae': 0.3063870966434479, 'eval_r2': 0.06514821503091528, 'eval_smape': 92.38393831877728, 'eval_runtime': 0.3485, 'eval_samples_per_second': 657.042, 'eval_steps_per_second': 83.206, 'epoch': 4.0}\n","{'loss': 0.0891, 'learning_rate': 1.33993399339934e-05, 'epoch': 4.95}\n","{'eval_loss': 0.17303620278835297, 'eval_mse': 0.17303620278835297, 'eval_rmse': 0.4159761965274811, 'eval_mae': 0.3093351125717163, 'eval_r2': -0.010628472643962494, 'eval_smape': 93.18160650927948, 'eval_runtime': 0.5094, 'eval_samples_per_second': 449.56, 'eval_steps_per_second': 56.931, 'epoch': 5.0}\n","{'eval_loss': 0.18124009668827057, 'eval_mse': 0.18124006688594818, 'eval_rmse': 0.42572298645973206, 'eval_mae': 0.31212055683135986, 'eval_r2': -0.058543811204373686, 'eval_smape': 97.72820005458514, 'eval_runtime': 0.3453, 'eval_samples_per_second': 663.148, 'eval_steps_per_second': 83.979, 'epoch': 6.0}\n","{'eval_loss': 0.1904619038105011, 'eval_mse': 0.1904619038105011, 'eval_rmse': 0.43641942739486694, 'eval_mae': 0.3197553753852844, 'eval_r2': -0.11240448330126274, 'eval_smape': 93.61574611080786, 'eval_runtime': 0.3443, 'eval_samples_per_second': 665.107, 'eval_steps_per_second': 84.228, 'epoch': 7.0}\n","{'loss': 0.0489, 'learning_rate': 1.00990099009901e-05, 'epoch': 7.43}\n","{'eval_loss': 0.2026669681072235, 'eval_mse': 0.2026669979095459, 'eval_rmse': 0.45018550753593445, 'eval_mae': 0.325164794921875, 'eval_r2': -0.1836890221901235, 'eval_smape': 94.31355758733623, 'eval_runtime': 0.3461, 'eval_samples_per_second': 661.571, 'eval_steps_per_second': 83.78, 'epoch': 8.0}\n","{'eval_loss': 0.1932864785194397, 'eval_mse': 0.1932864785194397, 'eval_rmse': 0.43964359164237976, 'eval_mae': 0.3106621503829956, 'eval_r2': -0.12890158510790628, 'eval_smape': 94.1749880594978, 'eval_runtime': 0.4776, 'eval_samples_per_second': 479.517, 'eval_steps_per_second': 60.725, 'epoch': 9.0}\n","{'loss': 0.0311, 'learning_rate': 6.798679867986799e-06, 'epoch': 9.9}\n","{'eval_loss': 0.17905329167842865, 'eval_mse': 0.17905326187610626, 'eval_rmse': 0.4231468439102173, 'eval_mae': 0.3167729377746582, 'eval_r2': -0.04577154818059759, 'eval_smape': 94.44415256550218, 'eval_runtime': 0.5046, 'eval_samples_per_second': 453.792, 'eval_steps_per_second': 57.467, 'epoch': 10.0}\n","{'eval_loss': 0.1915927529335022, 'eval_mse': 0.1915927529335022, 'eval_rmse': 0.437713086605072, 'eval_mae': 0.314985990524292, 'eval_r2': -0.11900917209607909, 'eval_smape': 96.39174228984716, 'eval_runtime': 0.3648, 'eval_samples_per_second': 627.774, 'eval_steps_per_second': 79.5, 'epoch': 11.0}\n","{'eval_loss': 0.19781750440597534, 'eval_mse': 0.19781750440597534, 'eval_rmse': 0.4447667896747589, 'eval_mae': 0.31641149520874023, 'eval_r2': -0.1553653182918664, 'eval_smape': 94.25806836790393, 'eval_runtime': 0.3608, 'eval_samples_per_second': 634.657, 'eval_steps_per_second': 80.371, 'epoch': 12.0}\n","{'loss': 0.0232, 'learning_rate': 3.4983498349834986e-06, 'epoch': 12.38}\n","{'eval_loss': 0.1986498385667801, 'eval_mse': 0.1986498385667801, 'eval_rmse': 0.4457015097141266, 'eval_mae': 0.318815141916275, 'eval_r2': -0.16022662700200274, 'eval_smape': 96.08916143558952, 'eval_runtime': 0.3516, 'eval_samples_per_second': 651.337, 'eval_steps_per_second': 82.484, 'epoch': 13.0}\n","{'train_runtime': 339.2722, 'train_samples_per_second': 71.359, 'train_steps_per_second': 8.931, 'train_loss': 0.0686303979099387, 'epoch': 13.0}\n"]},{"output_type":"execute_result","data":{"text/plain":["TrainOutput(global_step=2626, training_loss=0.0686303979099387, metrics={'train_runtime': 339.2722, 'train_samples_per_second': 71.359, 'train_steps_per_second': 8.931, 'train_loss': 0.0686303979099387, 'epoch': 13.0})"]},"metadata":{},"execution_count":192}]},{"cell_type":"code","source":["trainer.evaluate()"],"metadata":{"id":"Mf19DwNAwutN","executionInfo":{"status":"ok","timestamp":1684711506691,"user_tz":-120,"elapsed":540,"user":{"displayName":"CARLOS RODRIGUEZ CALZADA","userId":"12667430431079591890"}},"colab":{"base_uri":"https://localhost:8080/"},"outputId":"084676c9-add7-456a-e392-6b7c9e14cf33"},"execution_count":193,"outputs":[{"output_type":"stream","name":"stdout","text":["{'eval_loss': 0.2026669681072235, 'eval_mse': 0.2026669979095459, 'eval_rmse': 0.45018550753593445, 'eval_mae': 0.325164794921875, 'eval_r2': -0.1836890221901235, 'eval_smape': 94.31355758733623, 'eval_runtime': 0.4762, 'eval_samples_per_second': 480.883, 'eval_steps_per_second': 60.898, 'epoch': 13.0}\n"]},{"output_type":"execute_result","data":{"text/plain":["{'eval_loss': 0.2026669681072235,\n"," 'eval_mse': 0.2026669979095459,\n"," 'eval_rmse': 0.45018550753593445,\n"," 'eval_mae': 0.325164794921875,\n"," 'eval_r2': -0.1836890221901235,\n"," 'eval_smape': 94.31355758733623,\n"," 'eval_runtime': 0.4762,\n"," 'eval_samples_per_second': 480.883,\n"," 'eval_steps_per_second': 60.898,\n"," 'epoch': 13.0}"]},"metadata":{},"execution_count":193}]},{"cell_type":"code","source":["trainer.eval_dataset = data_encodings['test']\n","trainer.evaluate()"],"metadata":{"id":"8Nebpu_swxep","executionInfo":{"status":"ok","timestamp":1684711507469,"user_tz":-120,"elapsed":780,"user":{"displayName":"CARLOS RODRIGUEZ CALZADA","userId":"12667430431079591890"}},"colab":{"base_uri":"https://localhost:8080/"},"outputId":"576cbbf6-0ff2-4adf-c2d0-6ff95290a92e"},"execution_count":194,"outputs":[{"output_type":"stream","name":"stdout","text":["{'eval_loss': 0.17266300320625305, 'eval_mse': 0.17266301810741425, 'eval_rmse': 0.4155274033546448, 'eval_mae': 0.29142504930496216, 'eval_r2': -0.02928359197810604, 'eval_smape': 89.17695396868251, 'eval_runtime': 0.7401, 'eval_samples_per_second': 625.618, 'eval_steps_per_second': 78.371, 'epoch': 13.0}\n"]},{"output_type":"execute_result","data":{"text/plain":["{'eval_loss': 0.17266300320625305,\n"," 'eval_mse': 0.17266301810741425,\n"," 'eval_rmse': 0.4155274033546448,\n"," 'eval_mae': 0.29142504930496216,\n"," 'eval_r2': -0.02928359197810604,\n"," 'eval_smape': 89.17695396868251,\n"," 'eval_runtime': 0.7401,\n"," 'eval_samples_per_second': 625.618,\n"," 'eval_steps_per_second': 78.371,\n"," 'epoch': 13.0}"]},"metadata":{},"execution_count":194}]},{"cell_type":"code","source":["def get_prediction(text):\n","    # prepare our text into tokenized sequence\n","    inputs = tokenizer(text, max_length=MAX_LEN, padding=\"max_length\", truncation=True, return_tensors=\"pt\").to(\"cuda\")\n","    outputs = model(**inputs)   #output is a tensor\n","    return outputs[0].item()    #we only have to return the value of the tensor by using item()"],"metadata":{"id":"SZbzOylrwzH9","executionInfo":{"status":"ok","timestamp":1684711507469,"user_tz":-120,"elapsed":4,"user":{"displayName":"CARLOS RODRIGUEZ CALZADA","userId":"12667430431079591890"}}},"execution_count":195,"outputs":[]},{"cell_type":"code","source":["y_pred=[get_prediction(text) for text in dataset['validation']['Message']]"],"metadata":{"id":"f_5Pjn6Yw0mZ","executionInfo":{"status":"ok","timestamp":1684711510685,"user_tz":-120,"elapsed":3219,"user":{"displayName":"CARLOS RODRIGUEZ CALZADA","userId":"12667430431079591890"}}},"execution_count":196,"outputs":[]},{"cell_type":"code","source":["# from sklearn.metrics import explained_variance_score\n","\n","def print_metrics(y_test, y_pred, lang=''):\n","    # print(\"Final results on the whole test dataset\")\n","    print('|   |MSE|RMSE|MAE|R2|SMAPE|PEARSON|')\n","    print('|---|---|---|---|---|---|---|')\n","\n","    mse = mean_squared_error(y_test, y_pred)\n","    # print (\"MSE: \", \"{:.2f}\".format(mse), end=', ')\n","\n","    rmse = np.sqrt(mean_squared_error(y_test, y_pred))\n","    # print(\"RMSE: \", \"{:.2f}\".format(rmse), end=', ')\n","    \n","    mae = mean_absolute_error(y_test, y_pred)\n","    # print(\"MAE: \", \"{:.2f}\".format(mae), end=', ')\n","\n","    r2 = r2_score(y_test, y_pred)\n","    # print(\"R2: \", \"{:.2f}\".format(r2), end=', ')\n","\n","    diff=[label-pred for (label,pred) in zip(y_test,y_pred)]\n","    smape= 1/len(y_test) * np.sum(2 * np.abs(diff) / (np.abs(y_test) + np.abs(y_pred))*100)\n","    # print(\"SMAPE: \", \"{:.2f}\".format(smape), end=', ')      \n","    \n","    pearson=stats.pearsonr(y_test, y_pred)[0]\n","    # print(\"PEARSON: \", \"{:.2f}\".format(pearson))\n","    # print()\n","\n","    text_table=str('|')+lang+str('|') +\"{:.2f}\".format(mse) \\\n","                +str('|')+\"{:.2f}\".format(rmse) \\\n","                +str('|')+\"{:.2f}\".format(mae) \\\n","                +str('|')+\"{:.2f}\".format(r2) \\\n","                +str('|')+\"{:.2f}\".format(smape) \\\n","                +str('|')+\"{:.2f}\".format(pearson) + str('|')\n","\n","    print(text_table)\n","    # print()\n"],"metadata":{"id":"O77RpRDow2sp","executionInfo":{"status":"ok","timestamp":1684711510686,"user_tz":-120,"elapsed":17,"user":{"displayName":"CARLOS RODRIGUEZ CALZADA","userId":"12667430431079591890"}}},"execution_count":197,"outputs":[]},{"cell_type":"code","source":["y_train = data_encodings['train']['label']\n","y_val = data_encodings['validation']['label']\n","y_test = data_encodings['test']['label']"],"metadata":{"id":"FkdfE-qW7y_9","executionInfo":{"status":"ok","timestamp":1684711510686,"user_tz":-120,"elapsed":16,"user":{"displayName":"CARLOS RODRIGUEZ CALZADA","userId":"12667430431079591890"}}},"execution_count":198,"outputs":[]},{"cell_type":"code","source":["#print_metrics(y_test, y_pred)\n","print_metrics(y_val, y_pred)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"yuJIBWvo7ddz","executionInfo":{"status":"ok","timestamp":1684711510686,"user_tz":-120,"elapsed":16,"user":{"displayName":"CARLOS RODRIGUEZ CALZADA","userId":"12667430431079591890"}},"outputId":"b8e233e2-de51-42a9-bf1d-71a430d2d415"},"execution_count":199,"outputs":[{"output_type":"stream","name":"stdout","text":["|   |MSE|RMSE|MAE|R2|SMAPE|PEARSON|\n","|---|---|---|---|---|---|---|\n","||0.20|0.45|0.33|-0.18|94.31|0.36|\n"]}]},{"cell_type":"code","source":["with open(\"/content/drive/My Drive/TFG/MentalRiskES/train/Task 1/task1_gold_b.txt\") as file:\n","  final_labels_list = file.readlines()\n","final_labels_list\n","\n","final_labels = {}\n","\n","for label in final_labels_list:\n","  if label == final_labels_list[0]:\n","    continue\n","\n","  key = \"\"\n","  value = \"\"\n","\n","  comma = False\n","  for letter in label:\n","    if letter == '\\n':\n","      continue\n","    if letter == ',':\n","      comma = True\n","      continue\n","    if not comma:\n","      key += letter\n","    else:\n","      value += letter\n","  \n","  final_labels[key] = float(value)\n"],"metadata":{"id":"iKs5yju97KRp","executionInfo":{"status":"ok","timestamp":1684711510687,"user_tz":-120,"elapsed":13,"user":{"displayName":"CARLOS RODRIGUEZ CALZADA","userId":"12667430431079591890"}}},"execution_count":200,"outputs":[]},{"cell_type":"code","source":["predicted_labels = {}\n","for subject in final_labels:\n","  predicted_labels[subject] = 0\n","for index,text in enumerate(data_validation['Message']):\n","  pred = get_prediction(text)\n","  if pred > predicted_labels[data_validation[index]['Subject']]:\n","    predicted_labels[data_validation[index]['Subject']] = pred"],"metadata":{"id":"G_i-aKG96jfm","executionInfo":{"status":"ok","timestamp":1684711513495,"user_tz":-120,"elapsed":2821,"user":{"displayName":"CARLOS RODRIGUEZ CALZADA","userId":"12667430431079591890"}}},"execution_count":201,"outputs":[]},{"cell_type":"code","source":["x = list(final_labels.values())\n","y = list(predicted_labels.values())"],"metadata":{"id":"5yMHodHnXOq8","executionInfo":{"status":"ok","timestamp":1684711513496,"user_tz":-120,"elapsed":10,"user":{"displayName":"CARLOS RODRIGUEZ CALZADA","userId":"12667430431079591890"}}},"execution_count":202,"outputs":[]},{"cell_type":"code","source":["for i in range(len(x)):\n","  if (x[i] == y[i]):\n","    y[i] += 0.001"],"metadata":{"id":"IJpHzQr4Un7f","executionInfo":{"status":"ok","timestamp":1684711513496,"user_tz":-120,"elapsed":9,"user":{"displayName":"CARLOS RODRIGUEZ CALZADA","userId":"12667430431079591890"}}},"execution_count":203,"outputs":[]},{"cell_type":"code","source":["print_metrics(x,y)"],"metadata":{"id":"NlXlXL1ksaNY","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1684711513497,"user_tz":-120,"elapsed":10,"user":{"displayName":"CARLOS RODRIGUEZ CALZADA","userId":"12667430431079591890"}},"outputId":"3e1efe8e-318d-4553-e1b4-70236b034cf2"},"execution_count":204,"outputs":[{"output_type":"stream","name":"stdout","text":["|   |MSE|RMSE|MAE|R2|SMAPE|PEARSON|\n","|---|---|---|---|---|---|---|\n","||0.27|0.52|0.38|-0.60|127.52|0.22|\n"]}]},{"cell_type":"code","source":["#dataset = load_dataset(\"csv\", data_files=data_path+\"train.csv\")\n","#\n","#predicted_labels = {}\n","#for subject in final_labels:\n","#  predicted_labels[subject] = []\n","#for index,text in enumerate(dataset['train']['Message']):\n","#  pred = get_prediction(text)\n","#  predicted_labels[dataset['train'][index]['Subject']].append(pred)\n","#for subject in predicted_labels:\n","#  total = 0\n","#  for value in predicted_labels[subject]:\n","#    total+= value\n","#  predicted_labels[subject] = total/len(predicted_labels[subject])"],"metadata":{"id":"xuPzZ2HCCMbn","executionInfo":{"status":"ok","timestamp":1684711513497,"user_tz":-120,"elapsed":5,"user":{"displayName":"CARLOS RODRIGUEZ CALZADA","userId":"12667430431079591890"}}},"execution_count":205,"outputs":[]}]}